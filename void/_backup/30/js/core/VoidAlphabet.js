/**
 * VoidAlphabet - данные модульного шрифта Void
 * 
 * Каждый глиф закодирован строкой из 50 символов:
 * - 25 модулей на сетке 5×5
 * - Каждый модуль = буква + цифра (тип + поворот)
 * 
 * Типы модулей:
 * S — (straight) вертикальная линия слева
 * R — (rounded) плавная дуга, радиус = размер модуля
 * B — (bend) крутая дуга, радиус = половина модуля
 * C — (central) вертикальная линия по центру
 * J — (joint) Т-образное соединение
 * L — (corner) L-образное соединение
 * E — (empty) пустая ячейка
 * 
 * Повороты: 0 = 0°, 1 = 90°, 2 = 180°, 3 = 270°
 */

export const VOID_ALPHABET = {
    // Латиница
    "A": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0S2L1S1S1S1L2S0E0E0E0S2",
    "B": "L1S1S1S1R2L0S3S3S3R3S0E0E0B0R2S0E0E0E0S2L0S3S3S3R3",
    "C": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0E0R0B2E0B1R3E0R0S3R3E0",
    "D": "L1S1S1R2E0S0E0E0B0R2S0E0E0E0S2S0E0E0B1R3L0S3S3R3E0",
    "E": "L1S1S1S1S1S0E0E0E0E0L1S1S1S1E0S0E0E0E0E0L0S3S3S3S3",
    "F": "L1S1S1S1S1S0E0E0E0E0L1S1S1S1E0S0E0E0E0E0S0E0E0E0E0",
    "G": "E0R1S1S1R2R1B3E0E0E0S0E0S1S1R2R0B2E0E0S2E0R0S3S3R3",
    "H": "S0E0E0E0S2S0E0E0E0S2L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2",
    "I": "S1S1J1S1S1E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0S3S3J3S3S3",
    "J": "S1S1S1S1L2E0E0E0E0S2S0E0E0E0S2R0B2E0B1R3E0R0S3R3E0",
    "K": "S0E0E0E0S2S0E0B1S3R3J0C1J2E0E0S0E0B0S1R2S0E0E0E0S2",
    "L": "S0E0E0E0E0S0E0E0E0E0S0E0E0E0E0S0E0E0E0E0L0S3S3S3S3",
    "M": "S0R1R2R1R2L1B3S2E0S2S0E0S2E0S2S0E0S2E0S2S0E0S2E0S2",
    "N": "S0R1S1S1R2L1B3E0E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2",
    "O": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0S2R0B2E0B1R3E0R0S3R3E0",
    "P": "L1S1S1S1R2L0B2E0E0S2S0R0S3S3R3S0E0E0E0E0S0E0E0E0E0",
    "Q": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0S2R0B2E0E0R2E0R0S3R3S2",
    "R": "L1S1S1S1R2S0E0E0E0S2L0S3S3S3R3S0E0E0B0R2S0E0E0E0S2",
    "S": "E0R1S1R2E0R1B3E0B0R2R0S3S1S1R2R0B2E0B1R3E0R0S3R3E0",
    "T": "S1S1J1S1S1E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0",
    "U": "S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2R0S3S3S3R3",
    "V": "S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2R0B2E0B1R3E0R0S3R3E0",
    //"V": "S0E0E0E0S2S0E0E0E0S2R0B2E0B1R3E0S0E0S2E0E0R0S3R3E0",
    "W": "S0E0C0E0S2S0E0C0E0S2S0B1J3B2S2S0S2E0S0S2R0R3E0R0R3",
    "X": "S1R2E0R1S1E0S2E0S0E0E0B0J1B3E0E0S2E0S0E0S3R3E0R0S3",
    "Y": "S1R2E0R1S1E0S2E0S0E0E0B0J1B3E0E0E0C0E0E0E0E0C0E0E0",
    "Z": "S1S1S1S1R2E0E0E0E0R3R1S1S1S1E0S0E0E0E0E0R0S3S3S3S3",
    
    // Цифры
    "0": "E0R1S1R2E0R1B3E0B0R2S0E0C1E0S2R0B2E0B1R3E0R0S3R3E0",
    "1": "E0S1L2E0E0E0E0S2E0E0E0E0S2E0E0E0E0S2E0E0S3S3L3S3S3",
    "2": "R1S1S1S1R2E0E0E0E0S2E0S3S3S3R3R1E0E0E0E0R0S3S3S3S3",
    "3": "S1S1S1S1R2E0E0E0E0R3E0S1S1S1R2E0E0E0E0S2S3S3S3S3R3",
    "4": "S0E0E0E0S2S0E0E0E0S2R0S3S3S3L3E0E0E0E0S2E0E0E0E0S2",
    "5": "L1S1S1S1S1R0E0E0E0E0E0S1S1S1R2E0E0E0E0S2R0S3S3S3R3",
    "6": "R1S1S1S1S1S0E0E0E0E0S0R1S1S1R2L1B3E0E0S2R0S3S3S3R3",
    "7": "S1S1S1S1R2E0E0E0E0R3E0E0R1S1E0E0E0S0E0E0E0E0S0E0E0",
    "8": "R1S1S1S1R2R0E0E0E0R3R1S1S1S1R2S0E0E0E0S2R0S3S3S3R3",
    "9": "R1S1S1S1R2S0E0E0B1L3R0S3S3R3S2E0E0E0E0S2S3S3S3S3R3",
    
    // Символы
    " ": "E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0",
    ".": "E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0B1B2E0E0E0B0B3E0E0",
    ",": "E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0C2E0E0E0E0C2E0E0",
    ":": "E0E0E0E0E0E0E0C0E0E0E0E0E0E0E0E0E0C0E0E0E0E0E0E0E0",
    "-": "E0E0E0E0E0E0E0E0E0E0E0C1C1C1E0E0E0E0E0E0E0E0E0E0E0",
    "—": "E0E0E0E0E0E0E0E0E0E0C1C1C1C1C1E0E0E0E0E0E0E0E0E0E0",
    "=": "E0E0E0E0E0E0S3S3S3E0E0E0E0E0E0E0S1S1S1E0E0E0E0E0E0",
    "\"": "E0S2E0S0E0E0S2E0S0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0",
    "+": "E0E0C0E0E0E0E0C0E0E0C1C1C1C1C1E0E0C0E0E0E0E0C0E0E0",
    "!": "E0E0C2E0E0E0E0C2E0E0E0E0C2E0E0E0E0E0E0E0E0E0S3E0E0",
    "?": "R1S1S1S1R2S0E0E0E0S2E0E0B1S3R3E0E0S2E0E0E0E0S3E0E0",
    "(": "R1S1S1E0E0S0E0E0E0E0S0E0E0E0E0S0E0E0E0E0R0S3S3E0E0",
    ")": "E0E0S1S1R2E0E0E0E0S2E0E0E0E0S2E0E0E0E0S2E0E0S3S3R3",
    "{": "E0R1S1E0E0R1B3E0E0E0S0E0E0E0E0R0B2E0E0E0E0R0S3E0E0",
    "}": "E0E0S1R2E0E0E0E0B0R2E0E0E0E0S2E0E0E0B1R3E0E0S3R3E0",
    "@": "R1S1S1S1R2S0R1S1R2S2S0S0E0S2S2S0R0S3B0B3R0S3S3S3R3",
    "/": "E0E0E0S2E0E0E0B1R3E0E0E0S0E0E0E0R1B3E0E0E0S0E0E0E0",
    "|": "E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0",
    "#": "E0C0E0C0E0S3J3S3J3S3E0C2E0C2E0S1J1S1J1S1E0C0E0C0E0",
    "№": "S0R1R2B1B2L1B3S2B0B3S0E0S2E0S3S0E0S2E0E0S0E0S2E0E0",
    
    // Кириллица
    "А": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0S2L1S1S1S1L2S0E0E0E0S2",
    "Б": "L1S1S1S1S1S0E0E0E0E0S0R1S1S1R2L1B3E0E0S2L0S3S3S3R3",
    "В": "L1S1S1S1R2L0S3S3S3R3S0E0E0B0R2S0E0E0E0S2L0S3S3S3R3",
    "Г": "L1S1S1S1S1S0E0E0E0E0S0E0E0E0E0S0E0E0E0E0S0E0E0E0E0",
    "Д": "E0E0R1S1R2E0R1B3E0S2E0S0E0E0S2E0S0E0E0S2S3L0S3S3L3",
    "Е": "L1S1S1S1S1S0E0E0E0E0L1S1S1S1E0S0E0E0E0E0L0S3S3S3S3",
    "Ё": "E0S1E0S1E0R1S1S1S1R2L0S3S3S3R3S0E0E0E0E0R0S3S3S3S3",
    "Ж": "S0E0C2E0S2R0E0C2E0R3E0R3C2R0E0R1E0C2E0R2S0E0C2E0S2",
    "З": "S1S1S1S1R2E0E0E0E0R3E0S1S1S1R2E0E0E0E0S2S3S3S3S3R3",
    "И": "S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0B1L3R0S3S3R3S2",
    "Й": "S0E0S1E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0B1L3R0S3S3R3S2",
    "К": "S0E0E0E0S2S0E0B1S3R3J0C1J2E0E0S0E0B0S1R2S0E0E0E0S2",
    "Л": "E0E0R1S1R2E0E0S0E0S2E0S2E0E0S2E0S2E0E0S2R0R3E0E0S2",
    "М": "R1R2E0R1R2S0S2E0S0S2S0S2E0S0S2S0S2E0S0S2S0E0C2E0S2",
    "Н": "S0E0E0E0S2S0E0E0E0S2L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2",
    "О": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0S2R0B2E0B1R3E0R0S3R3E0",
    "П": "R1S1S1S1R2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2",
    "Р": "L1S1S1S1R2L0B2E0E0S2S0R0S3S3R3S0E0E0E0E0S0E0E0E0E0",
    "С": "E0R1S1R2E0R1B3E0B0R2S0E0E0E0E0R0B2E0B1R3E0R0S3R3E0",
    "Т": "S1S1J1S1S1E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0E0E0C0E0E0",
    "У": "S0E0E0E0S2S0E0E0B1L3R0S3S3R3S2E0E0E0E0S2R0S3S3S3R3",
    "Ф": "R1S1J1S1R2S0E0C2E0S2S0B1J3B2S2R0R3C2R0R3E0E0C2E0E0",
    "Х": "S1R2E0R1S1E0S2E0S0E0E0B0J1B3E0E0S2E0S0E0S3R3E0R0S3",
    "Ц": "S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2S0E0E0E0R2R0S3S3R3S2",
    "Ч": "S0E0E0E0S2S0E0E0B1L3R0S3S3R3S2E0E0E0E0S2E0E0E0E0S2",
    "Ш": "S0E0C0E0S2S0E0C0E0S2S0E0C0E0S2S0E0C0E0S2R0S3J3S3R3",
    "Щ": "S0E0C0E0S2S0E0C0E0S2S0E0C0E0S2S0E0C0E0R2R0S3J3S3S2",
    "Ъ": "S1S0E0E0E0E0S0R1S1R2E0L1B3E0S2E0S0E0E0S2E0L0S3S3R3",
    "Ы": "S0E0E0E0S2S0R1R2E0S2L1B3S2E0S2S0E0S2E0S2L0S3R3E0S2",
    "Ь": "S0E0E0E0E0S0R1S1S1R2L1B3E0E0S2S0E0E0E0S2L0S3S3S3R3",
    "Э": "R1S1S1R2E0E0E0E0B0R2E0C3C3C3J2E0E0E0B1R3R0S3S3R3E0",
    "Ю": "S0E0R1R2E0S0E0S0B0R2J0J2E0E0S2S0E0S0B1R3S0E0R0R3E0",
    "Я": "R1S1S1S1L2S0E0E0E0S2R0S3S3S3L3R1B3E0E0S2S0E0E0E0S2",
};

/**
 * Альтернативные глифы для символов
 * Ключ - символ, значение - массив альтернативных глифов
 */
export const VOID_ALPHABET_ALTERNATIVES = {
    "A": [
        "E0R1S1R2E0E0S0E0S2E0R1B3E0B0R2J0C1C1C1J2S0E0E0E0S2",
        "S1S1S1S1S0E0E0E0E0S0R1S1S1S1S0S0E0E0E0S0R0S3S3R3R0",
        "E0L1S1L2E0E0S0E0S2E0R1B3E0B0R2J0C1C1C1J2S0E0E0E0S2",
        "E0R1S1R2E0R1B3E0B0R2L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2",
        "R1S1S1S1R2S0E0E0E0S2L0S3S3S3L3S0E0E0E0S2S0E0E0E0S2",
        "R1S1S1S1R2L0S3S3S3L3S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2",
        "E0R1S1R2E0E0S0E0S2E0E0L1S1L2E0R1B3E0B0R2S0E0E0E0S2"
    ],
    "А": [
        "E0R1S1R2E0E0S0E0S2E0R1B3E0B0R2J0C1C1C1J2S0E0E0E0S2",
        "S1S1S1S1S0E0E0E0E0S0R1S1S1S1S0S0E0E0E0S0R0S3S3R3R0",
        "E0L1S1L2E0E0S0E0S2E0R1B3E0B0R2J0C1C1C1J2S0E0E0E0S2",
        "E0R1S1R2E0R1B3E0B0R2L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2",
        "R1S1S1S1R2S0E0E0E0S2L0S3S3S3L3S0E0E0E0S2S0E0E0E0S2",
        "R1S1S1S1R2L0S3S3S3L3S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2",
        "E0R1S1R2E0E0S0E0S2E0E0L1S1L2E0R1B3E0B0R2S0E0E0E0S2"
    ],
    "B": [
        "L1S1S1S1R2L0S3S3S3R3S0E0E0E0E0L1S1S1S1R2L0S3S3S3R3",
        "L1S1S1S1R2S0B1S3S3R3S0S2E0E0E0S0B0S1S1R2L0S3S3S3R3",
        "R1S1S1S1R2S0E0B1S3R3J0C1J2E0E0S0E0B0S1R2R0S3S3S3R3",
        "L1S1S1S1R2S0E0E0E0S2S0E0E0B1R3L1S1S1S1R2L0S3S3S3R3",
        "L1S1S1S1L2S0E0B1S3L3J0C1J2E0E0S0E0B0S1L2L0S3S3S3L3",
        "S0E0E0E0E0L1S1S1R2E0S0E0E0B0R2S0E0E0E0S2L0S3S3S3R3"
    ],
    "В": [
        "L1S1S1S1R2L0S3S3S3R3S0E0E0E0E0L1S1S1S1R2L0S3S3S3R3",
        "L1S1S1S1R2S0B1S3S3R3S0S2E0E0E0S0B0S1S1R2L0S3S3S3R3",
        "R1S1S1S1R2S0E0B1S3R3J0C1J2E0E0S0E0B0S1R2R0S3S3S3R3",
        "L1S1S1S1R2S0E0E0E0S2S0E0E0B1R3L1S1S1S1R2L0S3S3S3R3",
        "L1S1S1S1L2S0E0B1S3L3J0C1J2E0E0S0E0B0S1L2L0S3S3S3L3",
        "S0E0E0E0E0L1S1S1R2E0S0E0E0B0R2S0E0E0E0S2L0S3S3S3R3"
    ],
    "O": [
        "R1S1S1S1R2R0B2E0B1R3E0S0E0S2E0R1B3E0B0R2R0S3S3S3R3",
        "R1S1S1S1R2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2R0S3S3S3R3",
        "R1R2E0R1R2R0B0S1B3R3E0S0E0S2E0R1B1S3B2R2R0R3E0R0R3",
        "L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2L0S3S3S3L3",
        "E0R1S1R2E0R1R1R2R2R2S0R1E0R3S2R0R0R0R3R3E0R0S3R3E0",
        "E0L1S1L2E0L1B3E0B0L2S0E0E0E0S2L0B2E0B1L3E0L0S3L3E0"
    ],
    "О": [
        "R1S1S1S1R2R0B2E0B1R3E0S0E0S2E0R1B3E0B0R2R0S3S3S3R3",
        "R1S1S1S1R2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2R0S3S3S3R3",
        "R1R2E0R1R2R0B0S1B3R3E0S0E0S2E0R1B1S3B2R2R0R3E0R0R3",
        "L1S1S1S1L2S0E0E0E0S2S0E0E0E0S2S0E0E0E0S2L0S3S3S3L3",
        "E0R1S1R2E0R1R1R2R2R2S0R1E0R3S2R0R0R0R3R3E0R0S3R3E0",
        "E0L1S1L2E0L1B3E0B0L2S0E0E0E0S2L0B2E0B1L3E0L0S3L3E0"
    ]
};

/**
 * Получить отредактированный глиф из localStorage
 * @param {string} char - символ
 * @param {number|null} alternativeIndex - индекс альтернативы (null = базовый, 1+ = альтернативы)
 * @returns {string|null} - код глифа или null если не найден
 */
function getEditedGlyphFromStorage(char, alternativeIndex) {
    try {
        const storageKey = 'voidGlyphEditor_editedGlyphs';
        const stored = localStorage.getItem(storageKey);
        if (!stored) return null;
        
        const editedGlyphs = JSON.parse(stored);
        const key = alternativeIndex === null ? 'base' : String(alternativeIndex);
        
        // Проверяем наличие глифа для символа и ключа
        if (editedGlyphs[char] && editedGlyphs[char][key]) {
            return editedGlyphs[char][key];
        }
    } catch (e) {
        console.error('Error loading edited glyph from storage:', e);
    }
    return null;
}

/**
 * Получить код глифа для символа
 */
export function getGlyph(char, options = {}) {
    const upperChar = char.toUpperCase();
    const alternativeIndex = options.alternativeIndex;
    
    // Получаем оригинальные данные
    const baseGlyph = VOID_ALPHABET[upperChar] || VOID_ALPHABET[" "];
    const alternatives = VOID_ALPHABET_ALTERNATIVES[upperChar];
    
    // Если индекс не указан (null или undefined) - возвращаем базовый глиф
    if (alternativeIndex === null || alternativeIndex === undefined) {
        // Сначала проверяем, есть ли отредактированная версия базового глифа
        const editedGlyph = getEditedGlyphFromStorage(upperChar, null);
        if (editedGlyph) {
            return editedGlyph;
        }
        return baseGlyph;
    }
    
    // Режим random: выбираем случайную альтернативу
    if (alternativeIndex === 'random') {
        // Включаем базовый глиф в выбор (индекс 0 = базовый, 1+ = альтернативы)
        const allGlyphs = [baseGlyph, ...(alternatives || [])];
        const randomIndex = Math.floor(Math.random() * allGlyphs.length);
        
        // Проверяем, есть ли отредактированная версия для выбранного индекса
        const selectedIndex = randomIndex === 0 ? null : randomIndex;
        const editedGlyph = getEditedGlyphFromStorage(upperChar, selectedIndex);
        if (editedGlyph) {
            return editedGlyph;
        }
        
        return allGlyphs[randomIndex];
    }
    
    // Конкретный индекс (число)
    if (typeof alternativeIndex === 'number') {
        // Индекс 0 = базовый глиф
        if (alternativeIndex === 0) {
            const editedGlyph = getEditedGlyphFromStorage(upperChar, null);
            if (editedGlyph) {
                return editedGlyph;
            }
            return baseGlyph;
        }
        
        // Индекс 1+ = альтернативы
        if (!alternatives || !alternatives.length) {
            return baseGlyph;
        }
        
        const altIndex = alternativeIndex - 1;
        if (altIndex >= 0 && altIndex < alternatives.length) {
            // Проверяем, есть ли отредактированная версия
            const editedGlyph = getEditedGlyphFromStorage(upperChar, alternativeIndex);
            if (editedGlyph) {
                return editedGlyph;
            }
            return alternatives[altIndex];
        }
    }
    
    return baseGlyph;
}

/**
 * Проверить, есть ли глиф для символа
 * @param {string} char - символ
 * @returns {boolean}
 */
export function hasGlyph(char) {
    return VOID_ALPHABET.hasOwnProperty(char.toUpperCase());
}

/**
 * Получить список всех доступных символов
 * @returns {string[]}
 */
export function getAvailableChars() {
    return Object.keys(VOID_ALPHABET);
}

