# –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (Undo/Redo)

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω—ã (Undo) –∏ –ø–æ–≤—Ç–æ—Ä–∞ (Redo) –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞.

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
```
js/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îî‚îÄ‚îÄ HistoryManager.js    // –ú–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- js/main.js                 // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è HistoryManager, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
- js/core/VoidExporter.js    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ collectPresetData() –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- index.html                 // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–Ω–æ–ø–∫–∏ Undo/Redo –≤ UI

---

## üîß –≠—Ç–∞–ø 1: –ú–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ (HistoryManager.js)

### 1.1 –ü–∞—Ç—Ç–µ—Ä–Ω Memento

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Memento (–°–Ω–∏–º–æ–∫) ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏.

**–ü–ª—é—Å—ã:**
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —É–∂–µ –µ—Å—Ç—å –º–µ—Ç–æ–¥ `collectPresetData()` –≤ VoidExporter, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ù–∞–¥—ë–∂–Ω—ã–π ‚Äî –∫–∞–∂–¥—ã–π —Å–Ω–∏–º–æ–∫ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–π —à–∞–≥

**–ú–∏–Ω—É—Å—ã:**
- –ë–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —à–∞–≥–æ–≤
- –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏–µ–º–ª–µ–º–æ ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–±–æ–ª—å—à–æ–µ (~10-20 KB –Ω–∞ —Å–Ω–∏–º–æ–∫)

### 1.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞

```javascript
class HistoryManager {
    constructor(maxSteps = 50) {
        this.undoStack = [];  // –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è Undo (—Å—Ç–µ–∫)
        this.redoStack = [];  // –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è Redo (—Å—Ç–µ–∫)
        this.maxSteps = maxSteps; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
        this.isRestoring = false;  // –§–ª–∞–≥, —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
    }
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    saveState(state) {
        if (this.isRestoring) return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
        
        // –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ JSON
        const serialized = JSON.stringify(state);
        
        // –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ç–µ–∫ Undo
        this.undoStack.push(serialized);
        
        // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞
        if (this.undoStack.length > this.maxSteps) {
            this.undoStack.shift(); // –£–¥–∞–ª–∏—Ç—å —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å Redo –ø—Ä–∏ –Ω–æ–≤–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
        this.redoStack = [];
    }
    
    // Undo ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    undo(currentState) {
        if (this.undoStack.length === 0) return null;
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redo
        this.redoStack.push(JSON.stringify(currentState));
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const previousState = JSON.parse(this.undoStack.pop());
        return previousState;
    }
    
    // Redo ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–º–µ–Ω—ë–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    redo(currentState) {
        if (this.redoStack.length === 0) return null;
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Undo
        this.undoStack.push(JSON.stringify(currentState));
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ Redo
        const nextState = JSON.parse(this.redoStack.pop());
        return nextState;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ Undo
    canUndo() {
        return this.undoStack.length > 0;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ Redo
    canRedo() {
        return this.redoStack.length > 0;
    }
    
    // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
    clear() {
        this.undoStack = [];
        this.redoStack = [];
    }
}
```

### 1.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏

–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏ –º–æ–∂–Ω–æ:
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (50-100)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ (LZ-string) –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ–ª—å—Ç—ã (–∏–∑–º–µ–Ω–µ–Ω–∏—è) –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª—ë–≥–∫–æ–µ, –ø–æ—ç—Ç–æ–º—É –¥–µ–ª—å—Ç—ã –Ω–µ –Ω—É–∂–Ω—ã.

---

## üîß –≠—Ç–∞–ø 2: –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é

### 2.1 –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `collectPresetData()` –∏–∑ VoidExporter, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç:

1. **settings.values** ‚Äî –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (stem, spacing, rotation, mode –∏ —Ç.–¥.)
2. **renderer.alternativeGlyphCache** ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≥–ª–∏—Ñ–æ–≤
3. **renderer.moduleTypeCache** ‚Äî –∫—ç—à —Ç–∏–ø–æ–≤ –º–æ–¥—É–ª–µ–π (–¥–ª—è Random mode)
4. **renderer.moduleValueCache** ‚Äî –∫—ç—à —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–æ–¥—É–ª–µ–π
5. **colorPalette** / **moduleColorCache** ‚Äî –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤ –∏ –∫—ç—à —Ü–≤–µ—Ç–æ–≤ –º–æ–¥—É–ª–µ–π
6. **alphabet.currentText** ‚Äî —Ç–µ–∫—É—â–∏–π —Ç–µ–∫—Å—Ç
7. **alphabet.currentFont** ‚Äî —Ç–µ–∫—É—â–∏–π —à—Ä–∏—Ñ—Ç

### 2.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–Ω–∏–º–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```javascript
{
    settings: {
        values: { ... }, // –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ settings.values
    },
    renderer: {
        alternativeGlyphCache: { ... },
        moduleTypeCache: { ... },
        moduleValueCache: { ... },
        colorPalette: { ... },
        moduleColorCache: { ... }
    },
    alphabet: {
        currentText: "...",
        currentFont: "..."
    }
}
```

---

## üîß –≠—Ç–∞–ø 3: –ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### 3.1 –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞ / –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤–≤–æ–¥–∞** ‚Äî —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤.

### 3.2 –¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

1. **–û—Ç–ø—É—Å–∫–∞–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞** (`mouseup`, `touchend`)
   - –í—Å–µ —Å–ª–∞–π–¥–µ—Ä—ã –≤ UI
   - RangeSliderController
   - SliderController

2. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞**
   - `blur` –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ
   - `Enter` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ
   - Debounce 300ms –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞**
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Mono/Poly/Dash/Stripes/etc.
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —à—Ä–∏—Ñ—Ç–∞–º–∏

4. **–î–µ–π—Å—Ç–≤–∏—è —Å –≥–ª–∏—Ñ–∞–º–∏**
   - –í—ã–±–æ—Ä –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≥–ª–∏—Ñ–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (Update button)

5. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤**
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–∞–ª–∏—Ç—Ä—ã
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ ColorPicker

### 3.3 Debounce –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞

–î–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å debounce, —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∏–º–≤–æ–ª–µ:

```javascript
let textInputDebounce = null;

textInput.addEventListener('input', (e) => {
    clearTimeout(textInputDebounce);
    textInputDebounce = setTimeout(() => {
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ 300ms –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
        saveStateToHistory();
    }, 300);
});
```

---

## üîß –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å main.js

### 4.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HistoryManager

```javascript
// –í –Ω–∞—á–∞–ª–µ main.js
const historyManager = new HistoryManager(50);

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
function saveStateToHistory() {
    const state = {
        settings: {
            values: { ...settings.values }
        },
        renderer: {
            alternativeGlyphCache: { ...renderer.alternativeGlyphCache },
            moduleTypeCache: { ...renderer.moduleTypeCache },
            moduleValueCache: { ...renderer.moduleValueCache },
            colorPalette: renderer.colorPalette ? [...renderer.colorPalette] : null,
            moduleColorCache: { ...renderer.moduleColorCache }
        },
        alphabet: {
            currentText: alphabet.currentText,
            currentFont: alphabet.currentFont
        }
    };
    
    historyManager.saveState(state);
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
function restoreStateFromHistory(state) {
    historyManager.isRestoring = true;
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å settings
    Object.assign(settings.values, state.settings.values);
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å renderer –∫—ç—à–∏
    renderer.alternativeGlyphCache = { ...state.renderer.alternativeGlyphCache };
    renderer.moduleTypeCache = { ...state.renderer.moduleTypeCache };
    renderer.moduleValueCache = { ...state.renderer.moduleValueCache };
    renderer.colorPalette = state.renderer.colorPalette ? [...state.renderer.colorPalette] : null;
    renderer.moduleColorCache = { ...state.renderer.moduleColorCache };
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å alphabet
    alphabet.currentText = state.alphabet.currentText;
    alphabet.currentFont = state.alphabet.currentFont;
    
    // –û–±–Ω–æ–≤–∏—Ç—å UI
    updateAllControls();
    renderer.render();
    
    historyManager.isRestoring = false;
}
```

### 4.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–°–ª–∞–π–¥–µ—Ä—ã:**
```javascript
// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–ª–∞–π–¥–µ—Ä–æ–≤
slider.addEventListener('mouseup', () => {
    saveStateToHistory();
});

slider.addEventListener('touchend', () => {
    saveStateToHistory();
});
```

**–¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ:**
```javascript
// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
textInput.addEventListener('blur', () => {
    saveStateToHistory();
});

textInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        saveStateToHistory();
    }
});
```

**–ö–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤:**
```javascript
// –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞
function switchMode(newMode) {
    saveStateToHistory(); // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
    settings.values.mode = newMode;
    // ...
}
```

---

## üîß –≠—Ç–∞–ø 5: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

### 5.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

```javascript
// –í main.js
document.addEventListener('keydown', (e) => {
    // Cmd+Z (Mac) –∏–ª–∏ Ctrl+Z (Windows/Linux) ‚Äî Undo
    if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {
        e.preventDefault();
        performUndo();
    }
    
    // Cmd+Shift+Z (Mac) –∏–ª–∏ Ctrl+Y (Windows/Linux) ‚Äî Redo
    if ((e.metaKey || e.ctrlKey) && (e.shiftKey && e.key === 'z' || e.key === 'y')) {
        e.preventDefault();
        performRedo();
    }
});

function performUndo() {
    if (!historyManager.canUndo()) return;
    
    const currentState = collectCurrentState();
    const previousState = historyManager.undo(currentState);
    
    if (previousState) {
        restoreStateFromHistory(previousState);
    }
}

function performRedo() {
    if (!historyManager.canRedo()) return;
    
    const currentState = collectCurrentState();
    const nextState = historyManager.redo(currentState);
    
    if (nextState) {
        restoreStateFromHistory(nextState);
    }
}
```

### 5.2 –¢–∞–±–ª–∏—Ü–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à

| –î–µ–π—Å—Ç–≤–∏–µ | Mac | Windows/Linux |
|----------|-----|---------------|
| Undo | `Cmd+Z` | `Ctrl+Z` |
| Redo | `Cmd+Shift+Z` | `Ctrl+Y` –∏–ª–∏ `Ctrl+Shift+Z` |

---

## üîß –≠—Ç–∞–ø 6: UI —ç–ª–µ–º–µ–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 6.1 –ö–Ω–æ–ø–∫–∏ Undo/Redo

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```html
<!-- –í index.html -->
<div class="control-group" id="historyControls">
    <button id="undoButton" title="Undo (Cmd+Z)" disabled>
        ‚Ü∂ Undo
    </button>
    <button id="redoButton" title="Redo (Cmd+Shift+Z)" disabled>
        ‚Ü∑ Redo
    </button>
</div>
```

### 6.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫

```javascript
function updateHistoryButtons() {
    const undoBtn = document.getElementById('undoButton');
    const redoBtn = document.getElementById('redoButton');
    
    if (undoBtn) {
        undoBtn.disabled = !historyManager.canUndo();
    }
    if (redoBtn) {
        redoBtn.disabled = !historyManager.canRedo();
    }
}

// –í—ã–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
saveStateToHistory();
updateHistoryButtons();
```

---

## üìã –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (1-2 —á–∞—Å–∞)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å HistoryManager.js
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã saveState, undo, redo
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ canUndo, canRedo
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö

### –§–∞–∑–∞ 2: –°–±–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è (1-2 —á–∞—Å–∞)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é collectCurrentState()
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º collectPresetData()
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

### –§–∞–∑–∞ 3: –¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (2-3 —á–∞—Å–∞)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ (debounce)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–≤–µ—Ç–æ–≤
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö —Å –≥–ª–∏—Ñ–∞–º–∏

### –§–∞–∑–∞ 4: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (1-2 —á–∞—Å–∞)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é restoreStateFromHistory()
2. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ settings.values
3. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ renderer –∫—ç—à–µ–π
4. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ alphabet
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 5: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (1 —á–∞—Å)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ keydown
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å performUndo()
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å performRedo()
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –û–°

### –§–∞–∑–∞ 6: UI —ç–ª–µ–º–µ–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1 —á–∞—Å)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ Undo/Redo –≤ HTML
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å updateHistoryButtons()
4. ‚úÖ –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —à–∞–≥–æ–≤ | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å maxSteps (50-100), —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–Ω–∏–º–∫–∏ |
| –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞ | –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ mouseup/touchend, –Ω–µ –ø—Ä–∏ mousemove |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ isRestoring |
| –†–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ (—Å–ª—É—á–∞–π–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ –∫—ç—à–∏, –≤–∫–ª—é—á–∞—è moduleTypeCache –∏ moduleValueCache |
| –¢–µ–∫—Å—Ç –≤–≤–æ–¥–∏—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ –∏–∑-–∑–∞ debounce | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å debounce —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–µ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ |
| –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å –±—Ä–∞—É–∑–µ—Ä–æ–º | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å preventDefault() |
| –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∫—ç—à–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ collectCurrentState() |

---

## üé® –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (Undo)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (Redo)
- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–ª–∞–π–¥–µ—Ä—ã, —Ç–µ–∫—Å—Ç, —Ä–µ–∂–∏–º—ã, —Ü–≤–µ—Ç–∞)
- –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
- –ò—Å—Ç–æ—Ä–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Ä–∞–∑—É–º–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —à–∞–≥–æ–≤ (50)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏

---

## üìä –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|--------|
| –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ | ‚≠ê‚≠ê (–Ω–∏–∑–∫–∞—è-—Å—Ä–µ–¥–Ω—è—è) |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | ‚≠ê (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ) |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–∞–º—è—Ç—å | ‚≠ê‚≠ê (—É–º–µ—Ä–µ–Ω–Ω–æ–µ, ~1-2 MB –¥–ª—è 50 —à–∞–≥–æ–≤) |
| –ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è) |

**–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 6-10 —á–∞—Å–æ–≤**

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–±—É–¥—É—â–µ–µ)

1. **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** ‚Äî –º–∏–Ω–∏–∞—Ç—é—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
2. **–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Å–Ω–∏–º–∫–∏** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å "—á–µ–∫–ø–æ–∏–Ω—Ç—ã" —Å –∏–º–µ–Ω–∞–º–∏
3. **–ò—Å—Ç–æ—Ä–∏—è –≤ localStorage** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
4. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π** ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ–¥–∏–Ω —à–∞–≥ –∏—Å—Ç–æ—Ä–∏–∏
5. **Timeline** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–∞—è —à–∫–∞–ª–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ª—é–±–æ–º—É —à–∞–≥—É
